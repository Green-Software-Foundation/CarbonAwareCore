"use strict";(self.webpackChunkcasdk_docs=self.webpackChunkcasdk_docs||[]).push([[3987],{3905:(e,t,a)=>{a.d(t,{Zo:()=>u,kt:()=>h});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var c=n.createContext({}),l=function(e){var t=n.useContext(c),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},u=function(e){var t=l(e.components);return n.createElement(c.Provider,{value:t},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,o=e.originalType,c=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),p=l(a),m=r,h=p["".concat(c,".").concat(m)]||p[m]||d[m]||o;return a?n.createElement(h,i(i({ref:t},u),{},{components:a})):n.createElement(h,i({ref:t},u))}));function h(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=a.length,i=new Array(o);i[0]=m;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s[p]="string"==typeof e?e:r,i[1]=s;for(var l=2;l<o;l++)i[l]=a[l];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}m.displayName="MDXCreateElement"},259:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>c,contentTitle:()=>i,default:()=>d,frontMatter:()=>o,metadata:()=>s,toc:()=>l});var n=a(7462),r=(a(7294),a(3905));const o={},i="7. Data Source Interfaces",s={unversionedId:"architecture/decisions/data-source-interfaces",id:"architecture/decisions/data-source-interfaces",title:"7. Data Source Interfaces",description:"Status",source:"@site/docs/architecture/decisions/0007-data-source-interfaces.md",sourceDirName:"architecture/decisions",slug:"/architecture/decisions/data-source-interfaces",permalink:"/carbon-aware-sdk/docs/architecture/decisions/data-source-interfaces",draft:!1,editUrl:"https://github.com/Green-Software-Foundation/carbon-aware-sdk/docs/architecture/decisions/0007-data-source-interfaces.md",tags:[],version:"current",sidebarPosition:7,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"6. Data Source Registration",permalink:"/carbon-aware-sdk/docs/architecture/decisions/data-source-registration"},next:{title:"8. Data Source Configuration",permalink:"/carbon-aware-sdk/docs/architecture/decisions/data-source-configuration"}},c={},l=[{value:"Status",id:"status",level:2},{value:"Date",id:"date",level:2},{value:"Context",id:"context",level:2},{value:"Decision",id:"decision",level:2},{value:"Consequences",id:"consequences",level:2},{value:"Current Implementation",id:"current-implementation",level:3},{value:"Interfaces",id:"interfaces",level:4},{value:"Aggregators",id:"aggregators",level:4},{value:"Configuration",id:"configuration",level:4},{value:"Future Implications",id:"future-implications",level:3},{value:"Green Impact",id:"green-impact",level:2}],u={toc:l},p="wrapper";function d(e){let{components:t,...a}=e;return(0,r.kt)(p,(0,n.Z)({},u,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"7-data-source-interfaces"},"7. Data Source Interfaces"),(0,r.kt)("h2",{id:"status"},"Status"),(0,r.kt)("p",null,"Accepted"),(0,r.kt)("h2",{id:"date"},"Date"),(0,r.kt)("p",null,"2022-11-1"),(0,r.kt)("h2",{id:"context"},"Context"),(0,r.kt)("p",null,"Data sources can meet the needs of multiple use-cases, but all data sources\nshould not be expected to meet all needs. Currently, the ",(0,r.kt)("inlineCode",{parentName:"p"},"JsonDataSource")," throws\na ",(0,r.kt)("inlineCode",{parentName:"p"},"NotImplementedException")," for forecast-related methods required by the\n",(0,r.kt)("inlineCode",{parentName:"p"},"ICarbonAwareDataSource")," interface. As functionality expands in this way it\nbecomes harder maintain data sources and it prevents programmatic understanding\nof which methods are actually available to the user."),(0,r.kt)("p",null,"For example, if someone wanted to expand functionality to include access to\npower generation sources (coal, hydro, solar, etc.), such a change breaks\nexisting data sources and likely forces them into a similar workaround of\nraising exceptions to meet the new interface. Users may similarly start to see a\n",(0,r.kt)("inlineCode",{parentName:"p"},"power-consumption")," command in the CLI that throws errors for the data source\nthey are using."),(0,r.kt)("h2",{id:"decision"},"Decision"),(0,r.kt)("p",null,"The project will strive toward the\n",(0,r.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Interface_segregation_principle"},"interface segregation principle"),"\nof ",(0,r.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/SOLID"},"SOLID")," design by using separate\ninterfaces for unique ",(0,r.kt)("a",{parentName:"p",href:"https://martinfowler.com/bliki/RoleInterface.html"},"roles"),"\nthat a data source may serve. This is often signalled by a different\nmodel/schema being returned by the methods."),(0,r.kt)("p",null,"A single data sources can implement multiple interfaces."),(0,r.kt)("h2",{id:"consequences"},"Consequences"),(0,r.kt)("h3",{id:"current-implementation"},"Current Implementation"),(0,r.kt)("h4",{id:"interfaces"},"Interfaces"),(0,r.kt)("p",null,"To align with this decision, the ",(0,r.kt)("inlineCode",{parentName:"p"},"ICarbonIntensityDataSource")," interface would be\nbroken into two interfaces:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"IEmissionsDataSource")," \u2013 for data sources of measured emissions data"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"IForecastDataSource")," \u2013 for data sources of forecasted emissions data")),(0,r.kt)("h4",{id:"aggregators"},"Aggregators"),(0,r.kt)("p",null,"There is also no need for these data sources to have a shared aggregator as none\nof the existing aggregator functions leverage both types of data together. Thus,\nthere should be two corresponding aggregators:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"EmissionsAggregator")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"ForecastAggregator"))),(0,r.kt)("p",null,"Each aggregator should have its own parameters class, however the appropriate\nway to split up the existing ",(0,r.kt)("inlineCode",{parentName:"p"},"CarbonAwareParameters")," class is less\nstraight-forward due to the large amount of shared code. How to split up this\nclass should be the subject of its own ADR, and it should continue to be shared\nby both aggregators until an agreed upon design has been reached."),(0,r.kt)("h4",{id:"configuration"},"Configuration"),(0,r.kt)("p",null,"Each data source type should be independently configurable. So an example config\nof"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "carbonAwareVars": {\n    "carbonIntensityDataSource": "WattTime"\n    // ...\n  }\n  // ...\n}\n')),(0,r.kt)("p",null,"becomes the following with no user-facing changes since WattTime implements both\ninterfaces:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "carbonAwareVars": {\n    "emissionsDataSource": "WattTime",\n    "forecastDataSource": "WattTime"\n    // ...\n  }\n  // ...\n}\n')),(0,r.kt)("p",null,"But it now becomes possible to configure different sources for each type."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "carbonAwareVars": {\n    "emissionsDataSource": "JSON",\n    "forecastDataSource": "WattTime"\n    // ...\n  }\n  // ...\n}\n')),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Other Config Considerations")," ",(0,r.kt)("em",{parentName:"p"},"When no data source is specified...")," Use a\ndefault data source following the\n",(0,r.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Null_object_pattern"},"null object pattern")," to\nprovide empty, but strongly-typed responses."),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"When the data source type is not implemented by the specified data source..."),"\nThrow an exception, alerting the operator to improper configuration."),(0,r.kt)("h3",{id:"future-implications"},"Future Implications"),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"New Aggregators")," A hypothetical feature which returned the differences between\nforecasted emissions and measured emissions would implement a\n",(0,r.kt)("inlineCode",{parentName:"p"},"ForecastEmissionsAggregator")," to get the data from both sources and do the\ncalculations."),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"New Interfaces")," A hypothetical feature which exposed power generation data\nwould create an ",(0,r.kt)("inlineCode",{parentName:"p"},"IPowerGenerationDataSource")," which any data source with access\nto such data could implement."),(0,r.kt)("p",null,'It would be configured by operators the same way as existing data source types,\nby looking up the matching name of the interface (without the leading "I") in\nthe ',(0,r.kt)("inlineCode",{parentName:"p"},"carbonAwareVars")," section of the config."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "carbonAwareVars": {\n    "emissionsDataSource": "JSON",\n    "forecastDataSource": "WattTime",\n    "powerGenerationDataSource": "MyNewDataSourceName"\n    // ...\n  }\n  // ...\n}\n')),(0,r.kt)("p",null,"Features would be exposed to consumers via a ",(0,r.kt)("inlineCode",{parentName:"p"},"PowerGenerationAggregator")," or some\njoint aggregator that merges data with another source, depending on the\nuse-case."),(0,r.kt)("h2",{id:"green-impact"},"Green Impact"),(0,r.kt)("p",null,"Neutral"))}d.isMDXComponent=!0}}]);